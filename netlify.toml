# Netlify configuration for Flutter Web app (2025 best practices)

[build]
# The actual build is handled by the Flutter plugin, but we keep a command for manual/UI deploys
command = "flutter build web --release --wasm --pwa-strategy=none"
publish = "build/web"

# Environment variables (optional, adjust as needed)
# environment = { FLUTTER_WEB_RENDERER = "html" }

# Use the official Flutter plugin for reliable SDK management
[[plugins]]
package = "netlify-plugin-flutter"

[plugins.inputs]
# Use stable channel (change to "beta" or specific version if needed)
channel = "stable"

# Security & HTTP headers
[[headers]]
for = "/*"
[headers.values]
X-Frame-Options = "DENY"
X-XSS-Protection = "1; mode=block"
X-Content-Type-Options = "nosniff"
Referrer-Policy = "strict-origin-when-cross-origin"
Permissions-Policy = "geolocation=(), microphone=(), camera=()"
Cross-Origin-Opener-Policy = "same-origin-allow-popups"
Content-Security-Policy = """
      default-src 'self';
      script-src 'self' 'unsafe-inline' 'unsafe-eval' https://apis.google.com https://accounts.google.com https://www.googletagmanager.com https://www.gstatic.com https://cdn.jsdelivr.net;
      style-src 'self' 'unsafe-inline' https://accounts.google.com https://fonts.googleapis.com;
      img-src 'self' data: blob: https: https://play.google.com https://www.gstatic.com https://lh3.googleusercontent.com;
      font-src 'self' data: https://fonts.gstatic.com;
      connect-src 'self' https://www.gstatic.com https://fonts.gstatic.com https://firestore.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://accounts.google.com https://www.googleapis.com https://firebaseremoteconfig.googleapis.com https://firebaseinstallations.googleapis.com https://cdn.jsdelivr.net https://api.locationiq.com https://wandrr-15f70.firebaseapp.com https://wandrr-15f70.firebasestorage.app https://oauth2.googleapis.com https://content-people.googleapis.com;
      frame-src 'self' https://accounts.google.com https://wandrr-15f70.firebaseapp.com;
      worker-src 'self' blob:;
      object-src 'none';
      base-uri 'self';
    """

# Long-term caching for immutable assets (Flutter hashes them)
[[headers]]
for = "/assets/**"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "/*.js"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "/*.css"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

# No caching for index.html (critical for SPA updates)
[[headers]]
for = "/index.html"
[headers.values]
Cache-Control = "no-cache, no-store, must-revalidate"

# SPA routing: serve index.html for all routes (200 status for client-side routing)
[[redirects]]
from = "/*"
to = "/index.html"
status = 200
force = true